
@{
    ViewData["Title"] = "AllPackagesPage";
    Layout = "_Layout_Backstage";
}

<h1>AllPackagesPage</h1>
<select id="selector" class="form-select" style="width:10em; margin-bottom:1em">
    <option></option>
</select>

<section>
    <table class="table">
        <thead>
            <tr>
            </tr>
        </thead>

        <tbody id="table">
        </tbody>
    </table>
</section>

@section Scripts{
    <script>
        const table = document.querySelector("#table");
        const selector = document.querySelector("#selector");
        (async () => {
            const response = await fetch('@Url.Content("~/package/AllPackages")')
            if (!response.ok) {
                console.log(`erroe message:${response.status}`)
                return
            }
            const datas = await response.json()
            console.log(datas);
            const package = datas.map(p => {
                return `
                        <tr>
                        <td>${p.packName}</td>
                        <td><img src="${'@Url.Content("~/assets/img/packageimages/")' + p.picture}" alt="${p.packName}" width="100" height="100" /></td>
                        <td>${p.price}</td>
                        <td>
                        <button type="button" class="btn btn-secondary">修改</button>
                                <button type="button" class="btn btn-danger">刪除</button></td>
                    </tr>
                `
            });
            table.innerHTML = package.join("");

            const pCategoryRes = await fetch('@Url.Content("~/package/PackageCategory")')
            if (!pCategoryRes.ok) {
                console.log(`erroe message:${pCategoryRes.status}`)
                return
            }
            const pCategoryDatas = await pCategoryRes.json()
            console.log("styles:" , pCategoryDatas);
            const seletorPackage = pCategoryDatas.map(s => `<option id="${s.packageStyleId}" value="${s.styleName}">${s.styleName}</option>`)
            selector.innerHTML = seletorPackage.join("");

        })()

        selector.addEventListener("change", async (e) => {
            table.innerHTML = "";
            const selectedOption = e.target.options[e.target.selectedIndex];
            const selectedId = selectedOption.id;
            console.log('Selected option ID:', selectedId);

            const url = `https://localhost:7160/api/TAllPackages/selectID?seletId=${selectedId}`;

            const packageRes = await fetch(url, {
                method: 'POST',
                body: '',
                headers: {
                    'Accept': 'text/plain',
                    'Content-Type': 'application/json'
                }
            });


            if (!packageRes.ok) {
                console.log(`erroe message:${packageRes.status}`)
                    return
                }
            const selePackageDatas = await packageRes.json();
            console.log("selected:" + selePackageDatas);
            const package = selePackageDatas.map(p => {
                return `
                                <tr>
                                <td>${p.packName}</td>
                                <td><img src="${'@Url.Content("~/assets/img/packageimages/")' + p.picture}" alt="${p.packName}" width="100" height="100" /></td>
                                <td>${p.price}</td>
                                         <td>
                                <button type="button" class="btn btn-secondary">修改</button>
                                        <button type="button" class="btn btn-danger">刪除</button></td>
                            </tr>
                        `
            });
            table.innerHTML = package.join("");
        })

    </script>
}




@section Styles {
    <style>

    </style>
}